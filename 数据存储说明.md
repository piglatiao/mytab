# 📦 数据存储和管理说明

## 🗄️ 数据存储位置

### 1. **浏览器本地存储（LocalStorage）**

所有数据都保存在浏览器的 LocalStorage 中，这是一个浏览器提供的本地存储空间。

#### 存储的数据包括：

| 键名 | 内容 | 说明 |
|------|------|------|
| `nav_bookmarks` | 所有书签数据 | JSON 格式，包含所有分类和书签 |
| `nav_custom_bg` | 当前背景图片 | URL 或 Base64 字符串 |
| `nav_bg_opacity` | 背景遮罩浓度 | 0-0.9 的数字 |
| `nav_uploaded_backgrounds` | 已上传的背景 | 数组，包含所有上传的图片 |
| `nav_sync_key` | 同步密钥 | 用于云同步的密钥 |
| `nav_last_sync` | 最后同步时间 | 时间戳 |
| `nav_sync_bin_id` | 云存储 ID | JSONBin.io 的 Bin ID |

#### 查看存储的数据：

1. **打开浏览器开发者工具**
   - Windows/Linux: 按 `F12`
   - Mac: 按 `Cmd + Option + I`

2. **进入 Application/存储 标签**
   - Chrome/Edge: 点击 **Application** 标签
   - Firefox: 点击 **存储** 标签

3. **查看 LocalStorage**
   - 展开左侧 **Local Storage**
   - 点击您的网站域名
   - 右侧会显示所有存储的数据

4. **查看具体内容**
   - 点击任意键名查看值
   - `nav_bookmarks` 是 JSON 格式，可以复制出来格式化查看

#### 数据大小限制：

- **LocalStorage 限制**: 通常 5-10MB
- **建议**: 
  - 上传的图片压缩后再上传
  - 定期导出数据备份
  - 不要上传过多大图片

---

## 📝 数据格式

### 书签数据结构（nav_bookmarks）

```json
{
  "分类名称": [
    {
      "title": "网站标题",
      "url": "https://网站地址",
      "icon": "图标URL或Base64（可选）",
      "visitCount": 0,
      "lastVisit": 0
    }
  ]
}
```

### 示例：

```json
{
  "常用工具": [
    {
      "title": "Google",
      "url": "https://www.google.com",
      "visitCount": 5,
      "lastVisit": 1234567890
    },
    {
      "title": "GitHub",
      "url": "https://github.com",
      "visitCount": 3,
      "lastVisit": 1234567891
    }
  ],
  "学习资源": [
    {
      "title": "MDN",
      "url": "https://developer.mozilla.org",
      "visitCount": 0,
      "lastVisit": 0
    }
  ]
}
```

---

## 🔄 添加书签后的数据流程

### 1. **用户添加书签**
```
用户点击"添加网站" 
→ 输入标题和URL 
→ 验证数据格式
```

### 2. **保存到内存**
```javascript
this.categories[categoryName].push({
  title: title.trim(),
  url: validUrl,
  visitCount: 0,
  lastVisit: 0
});
```

### 3. **保存到 LocalStorage**
```javascript
localStorage.setItem('nav_bookmarks', JSON.stringify(this.categories));
```

### 4. **自动同步（如果启用）**
```javascript
if (this.syncEnabled && this.syncKey) {
  this.syncData(); // 上传到云端
}
```

### 5. **页面实时更新**
- Alpine.js 自动检测数据变化
- 页面立即显示新书签
- 无需刷新页面

---

## 🔗 书签与源代码的映射

### ❌ **不会直接映射到源代码**

添加的书签**不会**修改 `index.html` 源代码，而是：

1. **保存在浏览器 LocalStorage**
   - 数据存储在浏览器本地
   - 每个浏览器独立存储
   - 不同设备不共享（除非使用云同步）

2. **页面加载时读取**
   ```javascript
   // 页面加载时
   init() {
     this.loadBookmarks(); // 从 LocalStorage 读取
   }
   
   loadBookmarks() {
     const saved = localStorage.getItem('nav_bookmarks');
     if (saved) {
       this.categories = JSON.parse(saved);
     }
   }
   ```

3. **动态渲染**
   - Alpine.js 根据数据动态生成 HTML
   - 不修改原始 HTML 文件
   - 每次打开页面都重新渲染

### ✅ **如果想要书签永久保存在源代码中**

如果您想让书签直接写入 HTML 文件，需要：

1. **手动编辑 `loadDefaultBookmarks()` 方法**
   ```javascript
   loadDefaultBookmarks() {
     this.categories = {
       "常用工具": [
         {title: "Google", url: "https://www.google.com"},
         {title: "GitHub", url: "https://github.com"},
         // 在这里添加您的书签
       ]
     };
   }
   ```

2. **或者导出数据后手动合并**
   - 点击"导出数据"
   - 复制 JSON 内容
   - 粘贴到 `loadDefaultBookmarks()` 方法中
   - 重新部署

---

## ☁️ 云同步存储

### 使用 JSONBin.io 作为云存储

当启用云同步时，数据会上传到 JSONBin.io：

1. **上传数据**
   ```
   本地数据 → JSONBin.io API → 云端存储
   ```

2. **存储位置**
   - 服务器: JSONBin.io
   - 访问: 通过 API 和同步密钥
   - 安全: 使用密钥加密

3. **下载数据**
   ```
   云端存储 → JSONBin.io API → 本地 LocalStorage
   ```

4. **数据同步流程**
   ```
   设备A添加书签 
   → 上传到云端 
   → 设备B下载数据 
   → 设备B显示新书签
   ```

---

## 🔍 如何查看和编辑数据

### 方法一：通过浏览器开发者工具

1. **打开开发者工具** (F12)
2. **进入 Console 标签**
3. **查看数据**:
   ```javascript
   // 查看所有书签
   JSON.parse(localStorage.getItem('nav_bookmarks'))
   
   // 查看背景设置
   localStorage.getItem('nav_custom_bg')
   
   // 查看所有存储的键
   Object.keys(localStorage).filter(k => k.startsWith('nav_'))
   ```

4. **编辑数据**:
   ```javascript
   // 获取数据
   let bookmarks = JSON.parse(localStorage.getItem('nav_bookmarks'));
   
   // 修改数据
   bookmarks['常用工具'].push({
     title: "新网站",
     url: "https://example.com",
     visitCount: 0,
     lastVisit: 0
   });
   
   // 保存回去
   localStorage.setItem('nav_bookmarks', JSON.stringify(bookmarks));
   
   // 刷新页面查看
   location.reload();
   ```

### 方法二：通过导出/导入功能

1. **导出数据**
   - 点击"导出数据"按钮
   - 保存 JSON 文件

2. **编辑 JSON 文件**
   - 用文本编辑器打开
   - 修改书签数据
   - 保存文件

3. **导入数据**
   - 目前需要手动通过控制台导入
   - 或使用云同步功能

---

## 🗑️ 删除书签

### 通过界面删除

1. **悬停在书签卡片上**
   - 右上角会出现红色 ❌ 按钮

2. **点击删除按钮**
   - 弹出确认对话框
   - 确认后立即删除

3. **自动保存**
   - 删除后自动保存到 LocalStorage
   - 如果启用云同步，自动同步

### 通过代码删除

```javascript
// 打开控制台 (F12)
let bookmarks = JSON.parse(localStorage.getItem('nav_bookmarks'));

// 删除某个分类的所有书签
delete bookmarks['分类名'];

// 删除某个分类的特定书签
bookmarks['常用工具'].splice(0, 1); // 删除第一个

// 保存
localStorage.setItem('nav_bookmarks', JSON.stringify(bookmarks));
location.reload();
```

---

## 🔄 数据备份和恢复

### 备份数据

1. **方法一：导出功能**
   - 点击"导出数据"
   - 保存 JSON 文件到安全位置

2. **方法二：云同步**
   - 启用云同步
   - 数据自动备份到云端

3. **方法三：手动复制**
   - 打开开发者工具
   - 复制 `nav_bookmarks` 的值
   - 保存到文本文件

### 恢复数据

1. **从云端恢复**
   - 输入同步密钥
   - 点击"下载数据"

2. **从 JSON 文件恢复**
   ```javascript
   // 打开控制台
   let data = {/* 粘贴您的 JSON 数据 */};
   localStorage.setItem('nav_bookmarks', JSON.stringify(data.bookmarks));
   location.reload();
   ```

---

## 📊 数据大小管理

### 查看数据大小

```javascript
// 打开控制台
function getLocalStorageSize() {
  let total = 0;
  for (let key in localStorage) {
    if (localStorage.hasOwnProperty(key)) {
      total += localStorage[key].length + key.length;
    }
  }
  return (total / 1024).toFixed(2) + ' KB';
}

console.log('LocalStorage 使用:', getLocalStorageSize());
```

### 优化建议

1. **压缩图片**
   - 上传前使用 TinyPNG 等工具压缩
   - 建议图片大小 < 500KB

2. **定期清理**
   - 删除不需要的书签
   - 删除不用的背景图片

3. **使用云同步**
   - 本地只保留必要数据
   - 完整数据保存在云端

---

## 🔐 数据安全

### 本地数据

- ✅ 保存在浏览器本地，其他网站无法访问
- ✅ 使用 HTTPS 加密传输
- ⚠️ 清除浏览器数据会丢失
- ⚠️ 其他人使用您的电脑可以访问

### 云端数据

- ✅ 使用同步密钥加密
- ✅ 只有知道密钥的人才能访问
- ✅ 数据保存在 JSONBin.io 服务器
- ⚠️ 不要分享您的同步密钥

### 建议

1. **定期备份**: 使用导出功能备份数据
2. **复杂密钥**: 使用复杂的同步密钥
3. **隐私模式**: 在公共电脑使用隐私模式
4. **及时退出**: 使用完毕清除浏览器数据

---

## 💡 常见问题

### Q: 换电脑后数据还在吗？
**A:** 不在。LocalStorage 是浏览器本地存储，换电脑需要：
- 使用云同步功能
- 或导出数据后在新电脑导入

### Q: 清除浏览器缓存会丢失数据吗？
**A:** 会！清除"网站数据"或"Cookie和网站数据"会删除 LocalStorage。
- 建议定期导出备份
- 或使用云同步

### Q: 数据会过期吗？
**A:** 不会。LocalStorage 数据永久保存，除非：
- 手动清除浏览器数据
- 卸载浏览器
- 使用隐私模式（关闭后清除）

### Q: 可以在手机和电脑间同步吗？
**A:** 可以！使用云同步功能：
1. 在电脑上设置同步密钥并上传
2. 在手机上输入相同密钥并下载
3. 数据自动同步

---

**数据安全，使用无忧！** 🎉
